import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';

import { Student } from "../models/student.model";

@Component({
  // selector: 'app-students-list',
  templateUrl: './students-list.component.html',
  styleUrls: ['./students-list.component.css']
})
export class StudentsListComponent implements OnInit {

  error: string = "";
  
  students: Student[] = [];

  filteredStudents: Student[] = [];


  private _searchTerm: string = "";


  get SearchTerm(): string {
    return this._searchTerm;
  }

  set SearchTerm(value: string) {
    this._searchTerm = value;
    this.filteredStudents = this.filterStudents(value);
  }

  filterStudents(searchString: string): Student[] {
    return this.students.filter(std =>
      std.name?.toLowerCase().indexOf(searchString.toLowerCase()) !== -1);
  }


  constructor(
      private _router: Router,
      private _route: ActivatedRoute
    ) { 

      const resolvedData : Student[] | string = this._route.snapshot.data['studentList'];

      if(Array.isArray(resolvedData)){
        this.students = resolvedData;
      }
      else{
        this.error = resolvedData;
      }
      
      if (this._route.snapshot.queryParamMap.has('searchTerm')) {
        this.SearchTerm = this._route.snapshot.queryParamMap.get('searchTerm')!;
      } 
      else {
        this.filteredStudents = this.students;
      }

  }

  ngOnInit(): void {

  }


  onDeleteNotification(idToBDeleted : number){
 
    const StdToDeletedIndex = this.filteredStudents.findIndex(e => e.id === idToBDeleted);
    if(StdToDeletedIndex !== -1){
      this.filteredStudents.splice(StdToDeletedIndex,1);
    }
  }

}
